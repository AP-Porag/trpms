name: üöÄ Deploy Laravel 12 (Inertia + React) to Hostinger

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout code
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Setup PHP
      - name: üêò Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          extensions: mbstring, bcmath, pdo_mysql
          tools: composer:v2

      # 3Ô∏è‚É£ Install Composer dependencies
      - name: üì¶ Install Composer dependencies
        run: |
          composer install \
            --no-dev \
            --prefer-dist \
            --optimize-autoloader \
            --no-interaction

      # 4Ô∏è‚É£ Setup Node
      - name: üü¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # 5Ô∏è‚É£ Install NPM dependencies
      - name: üì¶ Install NPM dependencies
        run: npm ci

      # 6Ô∏è‚É£ Build React / Inertia (Vite)
      - name: ‚öõÔ∏è Build frontend assets
        run: npm run build

      # 7Ô∏è‚É£ Prepare environment file (CI only)
      - name: ‚öôÔ∏è Prepare .env
        run: php -r "file_exists('.env') || copy('.env.staging', '.env');"

      - name: üìÇ Deploy to Hostinger via SFTP
        uses: SamKirkland/FTP-Deploy-Action@4.0.0
        with:
          protocol: sftp
          server: madbrain.dev
          username: ${{ secrets.SFTP_USERNAME }}
          password: ${{ secrets.SFTP_PASSWORD }}
          port: ${{ secrets.SFTP_PORT }}
          local-dir: ./
          server-dir: /home/u241149697/domains/madbrain.dev/public_html/trpms/
          exclude: |
            **/.git*
            **/.github/**
            **/node_modules/**
            **/tests/**
            **/.env
            **/.env.*
            **/storage/logs/**
            **/vendor/**/.git*

      # 9Ô∏è‚É£ (Optional) Done message
      - name: ‚úÖ Deployment finished
        run: echo "Laravel deployed successfully üöÄ"


#        $ cat ~/.ssh/id_ed25519.pub
#        ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA9W1Z2A7J15bXHPInoqYmkZokWoU/10bII+UBngwJNG github-actions-deploy
#
#        $ cat ~/.ssh/id_ed25519
#        -----BEGIN OPENSSH PRIVATE KEY-----
#        b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
#        QyNTUxOQAAACAPVtWdgOydeW1xzyJ6KmJpGaJFqFP9dGyCPlAZ4MCTRgAAAJi8PumsvD7p
#        rAAAAAtzc2gtZWQyNTUxOQAAACAPVtWdgOydeW1xzyJ6KmJpGaJFqFP9dGyCPlAZ4MCTRg
#        AAAEAO21vupG+HuSJuZ6YrEMWlYio5nYOTBNAdeyG8ENyIGA9W1Z2A7J15bXHPInoqYmkZ
#        okWoU/10bII+UBngwJNGAAAAFWdpdGh1Yi1hY3Rpb25zLWRlcGxveQ==
#        -----END OPENSSH PRIVATE KEY-----

